# 设计

这一次重构项目，包括使用更高版本的go、vue，以及实现更多微服务架构的功能。

首先重构网关、用户服务、云文件服务，然后是配套的web；
接下来一步一步重构现有功能，重构完成后添加新功能。

> 首个版本各服务之间固定端口，后续引入服务注册中心后，考虑从注册中心获取目标服务地址

网关：只接收http方法为`post`/`options`的请求，后者直接返回（不报错），前者转发请求到业务服务

- 可以做一些检查，例如从JWT里解出caller并在转发时带上（带在form-data或请求头）
- 需要提前注册可响应的请求，这样可以解决**过滤未知请求**和**这个请求应该发给哪个业务服务**问题

第一版包含网关服务和用户服务，其中用户服务包含接口：

- 登录
  - 用户输入用户名、密码、totp密码（需要设置）登录，忽略已锁定用户
  - 登录成功后维护一个token，后续可以用来限制多设备登录
- 查询：仅限管理员
  - 查询条件：分页，根据字段查询（一个字段，模糊查询）、是否查询锁定用户、排序方式（一个字段，升序/降序）
  - 返回用户总数、符合条件的用户数以及一页的用户
  - 无法查询比自己权限等级高的用户
- 创建：仅限管理员
  - 只能创建权限比自己低的用户
- 锁定/解锁：仅限管理员
- 修改昵称/密码/totp key：仅限自己
- 调整权限：仅限管理员
- 验证：其他服务调用

http server设计：
- 能否使用res data返回业务参数，使用invoke chain的res返回执行结果？
- 进一步封装http请求响应函数，想办法能不能再简洁一点
